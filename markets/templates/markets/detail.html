{% extends "base_generic.html" %}

{% block title %}
<title>{{market.name}}</title>
{% endblock %}

{% block contextualsidebar %}
{% if portfolio %}
Your balance in this market is 造{{portfolio.balance}}.
{% endif %}
{% endblock %}

{% block content %}
<h1>{{market.name}}</h1>
<p>Created by {{market.owner}}.
{% if user == market.owner %} <a href="{% url 'markets:market-edit' market.id %}">Edit this market.</a> {% endif %}
</p>

<p>
{{market.rules}}
</p>

{% if not user.is_authenticated %}
<p><a href="{%url 'login'%}?next={{request.path}}">Log in</a> to trade on this market.</p>
{% endif %}

<p>
Possible outcomes:
</p>
<ul>
	{% for option in market.option_set.all|dictsort:"closed" %}
	<li>
		{{option.name}}

		{% if option.closed %}
			- Closed at 造{{option.resolveprice}}
		{% else %}
			{% if user.is_authenticated %} - <a href="{% url 'markets:option-detail' option.id %}">Trade</a>
			{% endif %} - Latest price is 造{{option.mostRecentPrice}}
		{% endif %}
		{% if user == market.owner %} - <a href="{% url 'markets:option-edit' option.id %}">Edit</a>
		{% endif %}
	</li>
	{% endfor %}

	{% if user == market.owner %} <li>
		 <a href="{% url 'markets:option-create' market.id %}">Add new option</a> 
	</li> {% endif %}
</ul>

<h2> Leaderboard </h2>
<ol>
	{% for pf in market.portfolio_set.all|dictsortreversed:"balance" %}
		<li>{% if user == pf.owner %}<b>{% endif %} {{pf.owner}} - 造{{pf.balance}} {% if user == pf.owner %} (You)</b>{% endif %}</li>
	{% endfor %}
</ol>
{% endblock %}